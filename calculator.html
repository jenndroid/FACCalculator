<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jennifer's Calculator</title>
    <link href="calculator-styles.css" rel="stylesheet"> 
</head>
<body>
    <div class="calculator-box"> <!--everything for the calculator is in this container-->
        <div class="display-box"> <!--display screen container, will show current value variable-->
            <div data-current-value class="current-value">0</div>
        </div>

        <div class="calculator-buttons"> <!--used data-operation for linking buttons to js, classes and tags stay styling only-->
            <button data-all-clear class="long-button">AC</button>
            <button data-delete>DEL</button>
            <button class="opButton" data-operation>รท</button>
            <button data-number>1</button>
            <button data-number>2</button>
            <button data-number>3</button>
            <button class="opButton" data-operation>x</button>
            <button data-number>4</button>
            <button data-number>5</button>
            <button data-number>6</button>
            <button class="opButton" data-operation>-</button>
            <button data-number>7</button>
            <button data-number>8</button>
            <button data-number>9</button>
            <button class="opButton" data-operation>+</button>
            <button data-number>.</button> <!--decimal point is treated like part of a number in my functions-->
            <button data-number>0</button>
            <button class="long-button" data-equals >=</button>
        </div>
    </div>


<script>
    //connecting certain elements from the DOM to JS variables as un-reassignable consts
    const numberButtons = document.querySelectorAll('[data-number]'); //everything assigned data-number is a numberButton variable
    const operationsButtons = document.querySelectorAll('[data-operation]');
    const equalsButton = document.querySelector('[data-equals]');
    const deleteButton = document.querySelector('[data-delete]');
    const allClearButton = document.querySelector('[data-all-clear]');
    const currentValueTextElement = document.querySelector('[data-current-value]'); //this is the current value to be shown in display box

    /*calculator is set up so that currentValue is to the right of the operator, or when there is no operator
    and previousValue is to the left of the operator, when the operator is defined. 
    */

    //when we come into the calculator, each of the values are an empty string 
    //the operation is undefined.
    let currentValue = '0';
    let previousValue = '';
    let operation = undefined; 
    let computed = false;


    /*all functions declared straight away:
    updateDisplay: displays whatever has been set as currentValue in the display box
    appendNumber: concatenates single digits or a decimal point onto value
    deleteLast: cuts off last digit/decimal of value
    chooseOperation: allows user to define operation for sum, as well as start a value with a minus sign
    compute: reads operation and does sum, setting result to currentValue to be displayed
    clearAll: clears both values and sets operation to undefined again 
    */

    /*you can only ever work with currentValue. As soon as an operation selected, the value you were appending to 
    becomes 'previousValue' and can no longer be mutated.*/

    //update display
    function updateDisplay(){
        currentValueTextElement.innerText = currentValue;
    }

     //append number to current value:
     //takes whatever was passed to it by a numButton click, param number
    function appendNumber(number){
        //make sure that we cannot press 0 multiple times in a row
        //and that we clear current value to blank rather than appending to 0
        /*

        if(currentValue === '0'){
            if (number === '0'){
                return;
            }
            else{
            currentValue = '';
            }
        }
        */
        if (currentValue.length == 8){return;}
        if (currentValue === '0' && number === '0') {return;}
        if (currentValue === '0' && number !== '0') {currentValue = '';}
        //this means numbers cannot be appended to a result. Instead, a blank string will start
        if (computed == true){
            currentValue = '';
            computed = false;
        }
        

        //if this argument is a decimal but our currentValue already includes one, don't go further into function- just return
        if (number === '.' && currentValue.includes('.')){return;}

        //otherwise, what is selected is changed to string type, then concatenated to whatever is already in currentValue
        //POSSIBLE CHANGE: why not just have currentValue += number.toString? Surely we are changing to string type twice here? 
        currentValue = currentValue.toString() + number.toString(); 

        updateDisplay();
    }

    //delete last digit function
    function deleteLast(){
        //uses slice to return the first to n-1 digits of whatever is presently inside currentValue
        currentValue = currentValue.slice(0, currentValue.length-1);
        updateDisplay();
    }

    //choose operation function
    //takes operator as innerText of operator button pushed, as operator param
    function chooseOperation(operator){
        //this allows user to start the currentValue with a minus sign, 
        //only come into this clause if currentValue is blank and the operator selected was a minus. Else, return  
        if (currentValue === '0' || currentValue === ''){//this is the problem that means I cannot select two ops in a row
            if (operator === '-'){
                appendNumber(operator);
                updateDisplay();
                return;
            }
            else if (operation !== undefined){
                //if I already have an operator, two have been pressed in a row. Special case
                //make the new operator the user has just selected the operator
                //keep previousValue what is is
                //currentValue will remain blank, as it was when we came into clause
                //Don't go further into the function or previousValue will be assigned the blank currentValue: no computation possible
                operation = operator;
                previousValue = previousValue; 
                return;       
            } 
        }
        
        //do not allow user attempts to keep pressing minus at the start of currentValue
        if (currentValue === '-' && operator === '-'){
            return;
        }

        //this allows immediate execution logic
        //As soon as we have one thing either side of an operation, perform sum
        //the result of the computation will become currentValue, but the innerText is not updated so you won't see that. 
        //3 x 5 becomes result and then currentValue of 15. previousValue is then cleard
        //so when you subsequently press x 3 that 15 moves over to previousValue and pressing equals will result in 45.
        if (previousValue !== ''){
            compute();
        }

        //pass the operator innerText to the operation variable
        //send the value we were just appending to over to the left side of this operation, as previousValue
        //clear currentValue, ready to be built up 
        operation = operator;
        previousValue = currentValue; 
        currentValue = '';

        updateDisplay();
    }

    //compute function
    function compute(){
        //dividing by 0 produces an error
        if (operation == 'รท' && currentValue == '0'){
            currentValue = "undefined";
            updateDisplay();
            currentValue = '';
            previousValue = '';
            operation = undefined;
            computed = true;
            return;
        }
        
        let result = '';
        
        //POSSIBLE CHANGE: could just parse previousValue and currentValue as floats inline rather than declaring prev and curr
        //make sure the parseFloat function has worked: catch any mistakes here and return instantly
        //POSSIBLE CHANGE: return with an error statement saying that something was not a number for usability!
        let prev = parseFloat(previousValue); 
        let curr = parseFloat(currentValue);
        if (isNaN(prev) || isNaN(curr)){return;}

        //perform sum and assign result accordingly
        if (operation === 'รท'){
            result = prev / curr; 
        }
        else if (operation === 'x'){
            result = prev * curr; 
        }
        else if (operation === '+'){
            result = prev + curr; 
        }
        else if (operation === '-'){
            result = prev - curr; 
        }

        //result is sent to currentValue so updateDisplay will show it
        //decimal numbers are cut off by js after 16 decimal places
        //scrollbar will appear on display hover for long ints
        //previousValue is cleared so that setting an operation will allow immediate execution
        //operation cleared to undefined
        
        currentValue = result;
        previousValue = '';
        operation = undefined; 
        computed = true;

        updateDisplay();
    }

    //clear display and all values
    function clearAll(){
        currentValue = '0';
        previousValue = '';
        operation = undefined; 
        updateDisplay(); 
    }


    /*connecting buttons to functions*/

    //jumps over everything designated a number button with for each
    //adds an event listener: on click, send the button's innerText to the appendNumber func, 
    //then come back here and update the display
    numberButtons.forEach(button => {
        button.addEventListener('click', () => {
            appendNumber(button.innerText);
        })
    });


    operationsButtons.forEach(button => {
        button.addEventListener('click', () => {
            chooseOperation(button.innerText);
        })
    });

    allClearButton.addEventListener('click', () =>{
        clearAll();
    });

    deleteButton.addEventListener('click', () =>{
        //if you don't actually have anything for currentValue, just return instantly
        if (currentValue.length < 1 || currentValue === '0'){return;}
        deleteLast();
    });

    equalsButton.addEventListener('click', () =>{
        //if you don't have anything for currentValue, there is nothing on the right of the operation, so return 
        if (currentValue.length < 1){return;}
        compute();
    });

</script>

</body>
</html>